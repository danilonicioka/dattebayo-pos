openapi: 3.0.3
info:
  title: Dattebayo Restaurant POS API
  description: API for the Restaurant Point of Sale System
  version: 1.0.0
servers:
  - url: http://dtjak.ddns.net
    description: Production server
  - url: http://localhost:80
    description: Local development server
  - url: http://10.0.2.2:80
    description: Android Emulator localhost alias

paths:
  /api/health:
    get:
      summary: Health check endpoint
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  # Menu Endpoints
  /api/menu:
    get:
      summary: Get all menu items
      operationId: getAllMenuItems
      responses:
        '200':
          description: List of menu items
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MenuItem'
    post:
      summary: Create a new menu item
      operationId: createMenuItem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MenuItem'
      responses:
        '200':
          description: Created menu item
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MenuItem'

  /api/menu/available:
    get:
      summary: Get available menu items
      operationId: getAvailableMenuItems
      responses:
        '200':
          description: List of available menu items
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MenuItem'

  /api/menu/category/{category}:
    get:
      summary: Get menu items by category
      operationId: getMenuItemsByCategory
      parameters:
        - name: category
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of menu items in category
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MenuItem'

  /api/menu/categories:
    get:
      summary: Get all categories
      operationId: getAllCategories
      responses:
        '200':
          description: List of categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  /api/menu/{id}:
    get:
      summary: Get menu item by ID
      operationId: getMenuItemById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Menu item found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MenuItem'
        '404':
          description: Menu item not found
    put:
      summary: Update menu item
      operationId: updateMenuItem
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MenuItem'
      responses:
        '200':
          description: Updated menu item
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MenuItem'
    delete:
      summary: Delete menu item
      operationId: deleteMenuItem
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Menu item deleted

  /api/menu/{id}/available:
    patch:
      summary: Toggle menu item availability
      operationId: toggleMenuItemAvailability
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAvailabilityRequest'
      responses:
        '200':
          description: Updated menu item
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MenuItem'

  # Order Endpoints
  /api/orders:
    get:
      summary: Get all orders
      operationId: getAllOrders
      responses:
        '200':
          description: List of all orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'
    post:
      summary: Create a new order
      operationId: createOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: Order created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'

  /api/orders/kitchen:
    get:
      summary: Get kitchen orders
      operationId: getKitchenOrders
      responses:
        '200':
          description: List of kitchen orders (PENDING/PREPARING)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'

  /api/orders/{id}:
    get:
      summary: Get order by ID
      operationId: getOrderById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '404':
          description: Order not found

  /api/orders/{id}/status:
    put:
      summary: Update order status
      operationId: updateOrderStatus
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: status
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/OrderStatus'
      responses:
        '200':
          description: Updated order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'

components:
  schemas:
    HealthStatus:
      type: object
      properties:
        status:
          type: string
          enum: [UP, DOWN]

    Category:
      type: string

    # DTOs
    MenuItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        price:
          type: number
          format: double
        category:
          type: string
        available:
          type: boolean
        applyMarkup:
          type: boolean
        manualPrice:
          type: number
          format: double
        manualPriceEnabled:
          type: boolean
        variations:
          type: array
          items:
            $ref: '#/components/schemas/MenuItemVariation'

    MenuItemVariation:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        type:
          type: string
        additionalPrice:
          type: number
          format: double

    Order:
      type: object
      properties:
        id:
          type: integer
          format: int64
        tableNumber:
          type: string
        status:
          $ref: '#/components/schemas/OrderStatus'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        notes:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        total:
          type: number
          format: double

    OrderItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        menuItemId:
          type: integer
          format: int64
        menuItemName:
          type: string
        quantity:
          type: integer
        price:
          type: number
          format: double
        specialInstructions:
          type: string
        subtotal:
          type: number
          format: double
        variations:
          type: array
          items:
            $ref: '#/components/schemas/OrderItemVariation'

    OrderItemVariation:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        type:
          type: string
        additionalPrice:
          type: number
          format: double

    # Request DTOs
    CreateOrderRequest:
      type: object
      required:
        - items
      properties:
        tableNumber:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItemRequest'
        notes:
          type: string

    OrderItemRequest:
      type: object
      required:
        - menuItemId
        - quantity
      properties:
        menuItemId:
          type: integer
          format: int64
        quantity:
          type: integer
          minimum: 1
        specialInstructions:
          type: string
        variations:
          type: array
          items:
            $ref: '#/components/schemas/OrderItemVariationRequest'

    OrderItemVariationRequest:
      type: object
      required:
        - menuItemVariationId
        - selected
      properties:
        menuItemVariationId:
          type: integer
          format: int64
        selected:
          type: boolean
        quantity:
          type: integer

    UpdateAvailabilityRequest:
      type: object
      properties:
        available:
          type: boolean

    # Enums
    OrderStatus:
      type: string
      enum: [PENDING, PREPARING, READY, DELIVERED, COMPLETED, CANCELLED]
